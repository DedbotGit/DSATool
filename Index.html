<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Ship Design Calculator</title>
  <style>
    /* Reset default margins/paddings and box-sizing */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Set a background color and add some spacing */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8f8f8;
      padding: 20px;
      margin: 0;
    }

    /* Main heading style */
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-size: 2.5rem;
    }

    /* Updated Grid container style */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    /* Section styling */
    .section {
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      margin: 10px;
      transition: transform 0.3s ease-in-out;
      position: relative;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-color: #4CAF50;
      /* Updated section background color */
      background-image: none;
      /* Remove background gradient */
    }

    /* Updated hover effect for sections combined with the animated effect */
    .section:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
      background-color: #48A869;
      /* Hover color change */
    }

    /* Input and label styles */
    label {
      font-weight: bold;
      margin-bottom: 10px;
      display: block;
      color: #333;
      font-size: 1rem;
    }

    input,
    select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      margin-bottom: 15px;
      background-color: #f4f4f4;
      color: #333;
      font-size: 1rem;
    }
  </style>
</head>

<body>
  <h1>Ship Design Calculator</h1>
  <div class="grid-container">
    <div class="section">
      <h2>Ship Information</h2>
      <form>
        <label for="shipSizeX">Ship Size X (in meters, max 78):</label>
        <br>
        <input type="number" id="shipSizeX" name="shipSizeX" max="78" min="0" placeholder="30" value="30">
        <br>
        <label for="shipSizeY">Ship Size Y (in meters, max 78):</label>
        <br>
        <input type="number" id="shipSizeY" name="shipSizeY" max="78" min="0" placeholder="30" value="30">
        <br>
        <label for="thrusterCount">Number of Thrusters (max 104):</label>
        <br>
        <input type="number" id="thrusterCount" name="thrusterCount" max="104" min="0" placeholder="16" value="16">
        <br>
        <label for="shipSpeed">Speed (in m/s):</label>
        <br>
        <input type="string" id="shipSpeed" name="shipSpeed" readonly>
      </form>
    </div>
    <div class="section">
      <h2>Shield Information</h2>
      <form>
        <label for="shieldGenerators">Number of Shield Generators:</label>
        <br>
        <input type="number" id="shieldGenerators" name="shieldGenerators" max="760" min="0" placeholder="20"
          value="20">
        <br>
        <label for="shieldTanks">Number of Shield Tanks:</label>
        <br>
        <input type="number" id="shieldTanks" name="shieldTanks" max="1521" min="0" placeholder="20" value="20">
        <br>
        <label for="totalHealth">Total Health:</label>
        <br>
        <input type="string" id="totalHealth" name="totalHealth" readonly>
        <br>
        <label for="shieldSpace">Space needed:</label>
        <br>
        <input type="string" id="shieldSpace" name="shieldSpace" readonly>
        <br>
        <label for="shieldRegen">Shield Regen (HP/second):</label>
        <br>
        <input type="string" id="shieldRegen" name="shieldRegen" readonly>
        <br>
        <label for="timeToFullHealth">Time to Full Health (s):</label>
        <br>
        <input type="string" id="timeToFullHealth" name="timeToFullHealth" readonly>
      </form>
    </div>

    <div class="section">
      <h2>Weapons Information</h2>
      <form>
        <label for="numTurrets">Maximum Number of Turrets:</label>
        <br>
        <input type="string" id="numTurrets" name="numTurrets" max="104" min="0" placeholder="80" value="80" disabled>
        <br>
        <label for="ammoType">Select Ammo Type:</label>
        <br>
        <select id="ammoType" name="ammoType">
          <option value="trashAmmo">Trash Ammo</option>
          <option value="standardAmmo" selected>Standard Ammo</option>
          <option value="flakAmmo">Flak Ammo</option>
          <option value="slugAmmo">Slug Ammo</option>
          <option value="punchAmmo">Punch Ammo</option>
          <option value="yankAmmo">Yank Ammo</option>
          <option value="scattershotAmmo">Scattershot Ammo</option>
          <option value="sniperAmmo">Sniper Ammo</option>
        </select><br>
        <label for="ammoConsumptionRate">Ammo Consumption Rate (per second per turret):</label><br>
        <input type="string" id="ammoConsumptionRate" name="ammoConsumptionRate" readonly placeholder="0">
        <br>
        <label for="firePercentage">Percent of Time Firing Turrets: <span
            id="firePercentageIndicator">50%</span></label><br>
        <input type="range" id="firePercentage" name="firePercentage" min="0" max="100" value="50"
          oninput="updateFirePercentageIndicator(this.value); calculateFabricatorsRequired()" style="padding: 0px;"><br>
        <label for="fabricatorsRequired">Fabricators Required:</label><br>
        <input type="string" id="fabricatorsRequired" name="fabricatorsRequired" readonly placeholder="0">
      </form>
    </div>
    <script>

      document.getElementById("shipSizeX").addEventListener("input", updateNumTurrets);
      document.getElementById("shipSizeY").addEventListener("input", updateNumTurrets);
      document.getElementById("thrusterCount").addEventListener("input", updateNumTurrets);
      document.getElementById("ammoType").addEventListener("input", calculateAmmoConsumption);
      document.getElementById("ammoConsumptionRate").addEventListener("input", calculateFabricatorsRequired);
      document.getElementById("shipSizeX").addEventListener("input", calculateSpeed);
      document.getElementById("shipSizeY").addEventListener("input", calculateSpeed);
      document.getElementById("thrusterCount").addEventListener("input", calculateSpeed);
      document.getElementById("shieldGenerators").addEventListener("input", calculateSpace);
      document.getElementById("shieldTanks").addEventListener("input", calculateSpace);
      document.getElementById("shieldGenerators").addEventListener("input", calculateShieldRegen);

      var productionRate = 0;

      function updateNumTurrets() {
        var sizeX = document.getElementById("shipSizeX").value;
        var sizeY = document.getElementById("shipSizeY").value;
        var thrusterCount = document.getElementById("thrusterCount").value;
        var numTurrets = Math.floor(sizeX / 3) * 2 + Math.floor(sizeY / 3) * 2 - thrusterCount;
        if (numTurrets > 104) {numTurrets = 104;}
        if (numTurrets < 0) {numTurrets = 0;}
        document.getElementById("numTurrets").value = numTurrets;
      }

      function calculateAmmoConsumption() {
        var ammoType = document.getElementById("ammoType").value;

        if (ammoType === "standardAmmo") {
          var ammoConsumptionRate = 1;
          productionRate = 4 / 3;
        } else if (ammoType === "trashAmmo") {
          var ammoConsumptionRate = 0.5;
          productionRate = 1 / 3;
        } else if (ammoType === "flakAmmo") {
          var ammoConsumptionRate = 0.5;
          productionRate = 4 / 3;
        } else if (ammoType === "punchAmmo") {
          var ammoConsumptionRate = 0.5;
          productionRate = 4 / 3;
        } else if (ammoType === "yankAmmo") {
          var ammoConsumptionRate = 0.5;
          productionRate = 4 / 3;
        } else if (ammoType === "scattershotAmmo") {
          var ammoConsumptionRate = 0.5;
          productionRate = 4 / 3;
        } else if (ammoType === "sniperAmmo") {
          var ammoConsumptionRate = 0.5;
          productionRate = 4 / 3;
        } else if (ammoType === "slugAmmo") {
          var ammoConsumptionRate = 0.25;
          productionRate = 4 / 3;
        }
        document.getElementById("ammoConsumptionRate").value = ammoConsumptionRate;
        calculateFabricatorsRequired();
      }

      function updateFirePercentageIndicator(value) {
        document.getElementById("firePercentageIndicator").innerText = value + '%';
      }

      function calculateFabricatorsRequired() {
        var firePercentage = document.getElementById("firePercentage").value / 100;
        var ammoConsumptionRate = document.getElementById("ammoConsumptionRate").value;
        var turretNumber = document.getElementById("numTurrets").value;
        var fabricatorsRequired = Math.ceil((ammoConsumptionRate * turretNumber * firePercentage * 0.5) / productionRate);
        document.getElementById("fabricatorsRequired").value = fabricatorsRequired;
      }

      function calculateSpeed() {
        var sizeX = document.getElementById("shipSizeX").value;
        var sizeY = document.getElementById("shipSizeY").value;
        var thrusterCount = document.getElementById("thrusterCount").value;
        document.getElementById("thrusterCount").max = Math.floor(sizeX / 3) * 2 + Math.floor(sizeY / 3) * 2;
        if (sizeX > 78) {
          document.getElementById("shipSizeX").value = 78;
          sizeX = 78;
        } else if (sizeX < 0) {
          document.getElementById("shipSizeX").value = 0;
          sizeX = 0;
        }
        if (sizeY > 78) {
          document.getElementById("shipSizeY").value = 78;
          sizeY = 78;
        } else if (sizeY < 0) {
          document.getElementById("shipSizeY").value = 0;
          sizeY = 0;
        }
        if (thrusterCount > 104) {
          document.getElementById("thrusterCount").value = 104;
          thrusterCount = 104;
        } else if (thrusterCount < 0) {
          document.getElementById("thrusterCount").value = 0;
          thrusterCount = 0;
        }
        var sizeFactor = 0.365; // Adjust this value as needed
        var thrusterFactor = 5; // Adjust this value as needed for diminishing returns
        var speed = 60 - (Math.sqrt(sizeX * sizeY) * sizeFactor) + (Math.sqrt(thrusterCount / 2) * thrusterFactor);


        var mass = (sizeX * sizeY) ** .5 * 2;

        // total_thrust maxes out at this value. The max-out is computed using a sigmoid function but the details of this are probably not too important.
        var total_thrust = thrusterCount * 1000
        //1 / (1 + Math.exp(x/2))
        var max_thrust = mass * 100;

        // thrusters provide 2000 thrust in the direction they face
        // thrusters provide 500 thrust in directions to their side
        // starter thrusters provide 50% the thrust of normal thrusters (1000 and 250)
        // starter thrusters on corners provide full thrust (1000) in the directions adjacent to their facing and less thrust (250) in other directions

        var max_speed = 20 + 0.4 * total_thrust / mass;

        // Solving these equations to get the absolute max speed:

        //max_speed = 20 + 0.4 * (mass * 100) / mass;
        //max_speed = 20 + 0.4 * 100;
        if (speed > 60) {speed = 60;}

        document.getElementById("shipSpeed").value = Math.max(0, max_speed);
      }

      function calculateSpace() {
        var totalShipSize = document.getElementById("shipSizeY").value * document.getElementById("shipSizeX").value;
        var generators = document.getElementById("shieldGenerators").value;
        var tanks = document.getElementById("shieldTanks").value;
        var space = generators * 8 + tanks * 4;
        var spacePercent = Math.round((space / totalShipSize) * 100)
        if (spacePercent > 100) {spacePercent = 100;}
        document.getElementById("shieldSpace").value = spacePercent + "%";
        document.getElementById("shieldGenerators").max = Math.floor((totalShipSize - (tanks * 4)) / 8);
        document.getElementById("shieldTanks").max = Math.floor((totalShipSize - (generators * 8)) / 4);
      }

      function updateHealthBar() {
        var totalHealth = 2000 + document.getElementById("shieldTanks").value * 500;
        // Update the health bar display here
        // ...
      }
      function calculateTanksForTotalShieldCapacity() {
        var generators = document.getElementById("shieldGenerators").value;
        var tanks = document.getElementById("shieldTanks").value;
        var activeTanks = tanks * 0.5; // Assuming 50% of tanks are active when the projector is enabled
        var totalShieldCapacity = generators * (10 + (activeTanks * 50)); // Calculate total shield capacity
        document.getElementById("totalHealth").value = totalShieldCapacity;
      }
      function calculateShieldRegen() {
        var generators = parseInt(document.getElementById("shieldGenerators").value)
        console.log(generators)
        // Diminishing returns factor
        //var regenRate = (1 / (-p * numOfGenerators + p + numOfGenerators)) * numOfGenerators * 100;
        var regenRate = Math.round((1 / ((-0.95 * generators) + 0.95 + generators)) * generators * 100)
        document.getElementById("shieldRegen").value = regenRate;
        calculateTimeToFullHealth();
        // Add any other logic for shield regen calculation here
      }
      function calculateTimeToFullHealth() {
        var totalHealth = document.getElementById("totalHealth").value;
        var regenRateTime = document.getElementById("shieldRegen").value;
        var timeToFullHealth = Math.round((totalHealth) / regenRateTime);
        document.getElementById("timeToFullHealth").value = timeToFullHealth;
      }
      document.getElementById("shieldGenerators").addEventListener("input", calculateTanksForTotalShieldCapacity);
      document.getElementById("shieldTanks").addEventListener("input", calculateTanksForTotalShieldCapacity);
      updateHealthBar();
      calculateShieldRegen();
      calculateTimeToFullHealth();
      calculateSpace();
      calculateTanksForTotalShieldCapacity();
      calculateSpeed();
      calculateFabricatorsRequired();
    </script>
  </div>
</body>

</html>
